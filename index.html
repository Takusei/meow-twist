<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Spotlight Launcher</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <div class="input-wrapper">
      <input id="search" placeholder="Search..." autocomplete="off" />
      <div id="ghost-suggestion" class="ghost"></div>
    </div>
    <div class="right-info">
      <span id="clock">--:-- --</span>
      <span class="icon">üîç</span>
    </div>
  </div>

  <script>
    const input = document.getElementById('search');
    const ghost = document.getElementById('ghost-suggestion');
    const clock = document.getElementById('clock');

    let commands = [];

    window.electronAPI.getCommands().then((cmds) => {
      commands = cmds;
    });
    let selectedIndex = -1;

    input.focus();

    const updateClock = () => {
      const now = new Date();
      let hours = now.getHours();
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12 || 12;
      clock.textContent = `${hours}:${minutes} ${ampm}`;
    };
    setInterval(updateClock, 1000);
    updateClock();

    input.addEventListener('input', () => {
      const rawText = input.value;
      const parts = rawText.split(/\s+/); // üî• no trim here
      const keyword = parts[0].toLowerCase();

      // If user typed space, or input is empty ‚Üí clear ghost
      if (!rawText || rawText.endsWith(' ')) {
        ghost.textContent = '';
        return;
      }

      const match = commands.find(cmd => cmd.startsWith(keyword));

      if (match && keyword !== match) {
        ghost.textContent = rawText + match.slice(keyword.length);
      } else {
        ghost.textContent = '';
      }
    });

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const finalValue = input.value.trim();
        window.electronAPI.search(finalValue);
        input.value = '';
        ghost.textContent = '';
        selectedIndex = -1;
      } else if (e.key === 'Escape') {
        window.electronAPI.hideWindow();
      } else if (e.key === 'Tab') {
        e.preventDefault();
        if (ghost.textContent) {
          const words = input.value.split(/\s+/);
          words[0] = ghost.textContent;
          input.value = words.join(' ') + ' ';
          ghost.textContent = '';
        }
      }
    });

    window.electronAPI.onReset(() => {
      input.value = '';
      ghost.textContent = '';
      selectedIndex = -1;
    });

    // If window or input loses focus, hide the search bar
    window.addEventListener('blur', () => {
      window.electronAPI.hideWindow();
    });

    input.addEventListener('blur', () => {
      // Extra safety: hide when clicking outside input
      setTimeout(() => {
        if (document.activeElement !== input) {
          window.electronAPI.hideWindow();
        }
      }, 100); // small delay to allow click events to complete
    });
  </script>
</body>
</html>
